aws-cli command line should be installed in the docker image for this
to work!

#### My logrotate file (/etc/logrotate.d/nginx) for my service looks like this:


/var/log/nginx/*.log {
  missingok
  rotate 14
  size 100k
  compress
  delaycompress
  notifempty
  create 0640 www-data adm
  sharedscripts
  prerotate
		  if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
			      run-parts /etc/logrotate.d/httpd-prerotate; \
		  fi \
  endscript
  postrotate
          invoke-rc.d nginx rotate >/dev/null 2>&1
          /bin/bash /home/ubuntu/reverse_proxy/app/utils/sync_rotated_file_to_s3.sh log.1
  endscript
}

#### The upstart job config file (/etc/init/shutdown-hook.conf) should look something like this:


description "run at shutdown"

start on starting rc
task
exec /bin/bash /home/ubuntu/reverse_proxy/app/utils/sync_rotated_file_to_s3.sh log



#### nginx config file must say in http { block }


    http {
        log_format custom    '$remote_addr-+-$status-+-[$time_iso8601]'
                               '-+-"$request"-+-$request_length-+-$request_time'
                               '-+-"$http_referer"-+-"$server_addr";

        server {
            access_log /var/log/nginx/access.log custom;
            error_log /var/log/nginx/error.log;
            ...
        }
    }

Example from access.log:
    # 190.191.147.145-+-200-+-[2019-05-21T19:59:28+00:00]-+-"GET /crops HTTP/1.1"-+-917-+-0.871-+-"https://...."-+-"172.31.0.170"


